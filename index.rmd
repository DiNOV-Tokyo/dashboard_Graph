---
title: "Graph examples"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
# https://dinov-tokyo.github.io/flexdashboard_ex/
# https://ramikrispin.github.io/2020/09/deploying-flexdashboard-on-github-pages/
# https://plotly.com/r/
library(flexdashboard)
library(tidyverse)
library(echarts4r)
library(nycflights13) # data

```


1st example
=====================================   


Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
library(plotly)

Animals <- c("giraffes", "orangutans", "monkeys")
SF_Zoo <- c(20, 14, 23)
LA_Zoo <- c(12, 18, 29)
data <- data.frame(Animals, SF_Zoo, LA_Zoo)

fig <- plot_ly(data, x = ~Animals, y = ~SF_Zoo, type = 'bar', name = 'SF Zoo')
fig <- fig %>% add_trace(y = ~LA_Zoo, name = 'LA Zoo')
fig <- fig %>% layout(yaxis = list(title = 'Count'), barmode = 'group')

fig
```

### Chart NY flight

```{r flight}

top_destinations <- flights %>% 
  count(dest) %>% 
  top_n(15, n) %>% 
  arrange(n)

top_destinations %>%
  e_charts(x = dest) %>%
  e_bar(n, legend = FALSE, name = "Flights") %>% 
  e_labels(position = "right") %>% 
  e_tooltip() %>% 
  e_title("Flights by destination", "Top 15 destinations") %>% 
  e_flip_coords() %>% 
  e_y_axis(splitLine = list(show = FALSE)) %>% 
  e_x_axis(show = FALSE) %>% 
  e_toolbox_feature(
    feature = "saveAsImage",
    title = "Save as image"
  )

```




Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
library(plotly)
library(tidyr)
library(plyr)

data <- spread(Orange, Tree, circumference)
data <- rename(data, c("1" = "Tree1", "2" = "Tree2", "3" = "Tree3", "4" = "Tree4", "5" = "Tree5"))

fig <- plot_ly(data, x = ~age, y = ~Tree1, type = 'scatter', mode = 'lines', name = 'Tree 1')
fig <- fig %>% add_trace(y = ~Tree2, name = 'Tree 2')
fig <- fig %>% add_trace(y = ~Tree3, name = 'Tree 3')
fig <- fig %>% add_trace(y = ~Tree4, name = 'Tree 4')
fig <- fig %>% add_trace(y = ~Tree5, name = 'Tree 5')

fig
```

### Chart C

```{r}

library(tidyverse)
library(lubridate)
library(ggtext)
library(gtrendsR)
library(showtext)

trend_raw <- gtrends("Trump", time = "2020-01-01 2020-12-31")

trend <- trend_raw %>% 
  collapse::unlist2d() %>% 
  as_tibble() %>% 
  filter(.id == "interest_over_time") %>% 
  select(date, hits) %>% 
  mutate(
    tiles = 1,
    date = as_date(date),
    hits = hits %>% 
      str_replace("<1", "0") %>% 
      as.numeric()
  )

trend %>% 
  ggplot(aes(date, tiles, height = 50*tiles, fill = hits)) + 
  geom_tile() + 
  scale_x_date(date_breaks = "months", date_labels = month.abb) +
  scale_y_continuous(limits = c(-100, NA)) +
  coord_polar(start = 0)

```

2nd example
=====================================   


Column
-----------------------------------------------------------------------

### Lollipop graph

```{r lollipop}

library(ggplot2)

mtcars$car <- row.names(mtcars)

mtcars_mean <- mtcars %>%
  arrange(disp) %>%
  mutate(mean_disp = mean(disp),
         flag = ifelse(disp - mean_disp > 0, TRUE, FALSE),
         car = factor(car, levels = .$car))

ggplot(mtcars_mean, aes(x = disp, y = car, color = flag)) +
  geom_segment(aes(x = mean_disp, y = car, xend = disp, yend = car)) +
  geom_point(size = 5)+
  scale_colour_manual(values = c("red", "blue")) +
  labs(title = "Displacement by Car") 

```


### table1


```{r table1}

library(table1)
library(tidyverse)

dat <- diamonds

label(dat$carat) <- "Carat"
label(dat$cut) <- "Cut"
label(dat$depth) <- "depth"
label(dat$table) <- "table"

units(dat$price) <- "doller"
units(dat$depth) <- "mm"

table1(~ carat + cut + depth + table + price, data=dat)


```